rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Students collection
    match /students/{studentId} {
      // Allow authenticated users to read their own student document
      allow read: if request.auth != null && request.auth.uid == studentId;
      
      // Allow any authenticated user to create their student document during signup
      allow create: if request.auth != null && request.auth.uid == studentId;
      
      // Allow users to update their own document (for lastLogin, etc.)
      allow update: if request.auth != null && request.auth.uid == studentId;
      
      // Management can read all students (you can lock this down further if needed)
      allow read: if request.auth != null;
    }
    
    // Drivers collection
    match /drivers/{driverId} {
      // Allow authenticated users to read their own driver document
      allow read: if request.auth != null && request.auth.uid == driverId;
      
      // Allow any authenticated user to create their driver document during signup
      allow create: if request.auth != null && request.auth.uid == driverId;
      
      // Allow drivers to update their own document
      allow update: if request.auth != null && request.auth.uid == driverId;
      
      // Management can read all drivers
      allow read: if request.auth != null;
    }
  }
}
